<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>1.47.&nbsp;Program Messages</title><link rel="stylesheet" type="text/css" href="resources/css/docbook_bsd.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="dhis2_developer_manual.html" title="DHIS2 Developer guide"><link rel="up" href="webapi.html" title="Chapter&nbsp;1.&nbsp;Web API"><link rel="prev" href="webapi_sms_commands.html" title="1.46.&nbsp;SMS Commands"><link rel="next" href="webapi_users.html" title="1.48.&nbsp;Users"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">1.47.&nbsp;Program Messages</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="webapi_sms_commands.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;1.&nbsp;Web API</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="webapi_users.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="webapi_program_messages"></a>1.47.&nbsp;Program Messages</h2></div></div></div><p>Program message lets you send messages to tracked entity instances, contact addresses
      assiociated with organisation units, phone numbers and email addresses. You can send messages
      through the <span class="emphasis"><em>messages</em></span> resource.</p><pre class="screen">/api/25/messages</pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e11199"></a>1.47.1.&nbsp;Sending program messages</h3></div></div></div><p>Program messages can be sent using two delivery channels:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>SMS (SMS)</p></li><li class="listitem"><p>Email address (EMAIL)</p></li></ul></div><p>Program messages can be sent to various recipients:</p><p> </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Tracked entity instance: The system will look up attributes of value type
              PHONE_NUMBER or EMAIL (depending on the specified delivery channels) and use the
              corresponding attribute values.</p></li><li class="listitem"><p>Organisation unit: The system will use the phone number or email information
              registered for the organisation unit.</p></li><li class="listitem"><p>List of phone numbers: The system will use the explicitly defined phone
              numbers.</p></li><li class="listitem"><p>List of email addresses: The system will use the explicitly defined email
              addresses.</p></li></ul></div><p>Below is a sample JSON payload for sending messages using POST requests. Note that
        message resource accepts a wrapper object named <span class="emphasis"><em>programMessages</em></span> which
        can contain any number of program messages.</p><pre class="screen">POST /api/25/messages</pre><pre class="screen">{
    "programMessages": [{
        "recipients": {
            "trackedEntityInstance": {
                "id": "UN810PwyVYO"
            },
            "organisationUnit": {
                "id": "Rp268JB6Ne4"
            },
            "phoneNumbers": [
                "55512345",
                "55545678"
            ],
            "emailAddresses": [
                "johndoe@mail.com",
                "markdoe@mail.com"
            ]
        },
        "programInstance": {
            "id": "f3rg8gFag8j"
        },
        "programStageInstance": {
            "id": "pSllsjpfLH2"
        },
        "deliveryChannels": [
            "SMS", "EMAIL"
        ],
        "subject": "Outbreak alert",
        "text": "An outbreak has been detected",
        "storeCopy": false
    }]
}</pre><p>The fields are explained in the following table.</p><div class="table"><a name="d0e11239"></a><p class="title"><b>Table&nbsp;1.85.&nbsp;Program message payload</b></p><div class="table-contents"><table class="table" summary="Program message payload" border="1"><colgroup><col class="c1"><col class="newCol2"><col class="c2"><col class="c3"></colgroup><thead><tr><th>Field</th><th>Required</th><th>Description</th><th>Values</th></tr></thead><tbody><tr><td>recipients</td><td>Yes</td><td>Recipients of the program message. At least one recipient must be specified.
                  Any number of recipients / types can be specified for a message.</td><td>Can be trackedEntityInstance, organisationUnit, an array of phoneNumbers or
                  an array of emailAddresses.</td></tr><tr><td>programInstance</td><td>Either this or programStageInstance required</td><td>The program instance / enrollment.</td><td>Enrollment ID.</td></tr><tr><td>programStageInstance</td><td>Either this or programInstance required</td><td>The program stage instance / event.</td><td>Event ID.</td></tr><tr><td>deliveryChannels</td><td>Yes</td><td>Array of delivery channels.</td><td>SMS | EMAIL</td></tr><tr><td>subject</td><td>No</td><td>The message subject. Not applicable for SMS delivery channel.</td><td>Text.</td></tr><tr><td>text</td><td>Yes</td><td>The message text.</td><td>Text.</td></tr><tr><td>storeCopy</td><td>No</td><td>Whether to store a copy of the program message in DHIS 2.</td><td>false (default) | true</td></tr></tbody></table></div></div><p><br class="table-break"></p><p>A minimalistic example for sending a message over SMS to a tracked entity instance looks
        like
        this:</p><pre class="screen">curl -d @message.json "https://play.dhis2.org/demo/api/25/messages" 
  -H "Content-Type:application/json" -u admin:district -v</pre><pre class="screen">{
    "programMessages": [{
        "recipients": {
            "trackedEntityInstance": {
                "id": "PQfMcpmXeFE"
            }
        },
        "programInstance": {
            "id": "JMgRZyeLWOo"
        },
        "deliveryChannels": [
            "SMS"
        ],
        "text": "Please make a visit on Thursday"
    }]
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e11327"></a>1.47.2.&nbsp;Retrieving and deleting program messages</h3></div></div></div><p>The list of messages can be retrieved using GET.</p><pre class="screen">GET /api/25/messages</pre><p>One particular message can also be retreived using GET.</p><pre class="screen">GET /api/25/messages/{uid}</pre><p>Message can be deleted using DELETE.</p><pre class="screen">DELETE /api/25/messages/{uid}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e11342"></a>1.47.3.&nbsp;Querying program messages</h3></div></div></div><p>The program message API supports program message queries based on request
        parameters. Messages can be filtered based on below mentioned query parameters. All requests should
        use the GET HTTP verb for retreiving information. </p><div class="table"><a name="d0e11347"></a><p class="title"><b>Table&nbsp;1.86.&nbsp;Query program messages API</b></p><div class="table-contents"><table class="table" summary="Query program messages API" border="1"><colgroup><col class="parameter"><col class="url"></colgroup><thead><tr><th>Parameter</th><th>URL</th></tr></thead><tbody><tr><td>programInstance</td><td>/api/25/messages?programInstance=6yWDMa0LP7</td></tr><tr><td>programStageInstance</td><td>/api/25/messages?programStageInstance=SllsjpfLH2</td></tr><tr><td>trackedEntityInstance</td><td>/api/25/messages?trackedEntityInstance=xdfejpfLH2</td></tr><tr><td>organisationUnit</td><td>/api/25/messages?ou=Sllsjdhoe3</td></tr><tr><td>processedDate</td><td>/api/25/messages?processedDate=2016-02-01</td></tr></tbody></table></div></div><p><br class="table-break"></p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="webapi_sms_commands.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="webapi.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="webapi_users.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">1.46.&nbsp;SMS Commands&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="dhis2_developer_manual.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;1.48.&nbsp;Users</td></tr></table></div></body></html>