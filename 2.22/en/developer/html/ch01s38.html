<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>1.38.&nbsp;Short Message Service (SMS)</title><link rel="stylesheet" type="text/css" href="resources/css/docbook_bsd.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><meta name="keywords" content="DHIS2, HMIS, aggregate data, Health Management Information System, Integrated data repository, Health Information System"><link rel="home" href="dhis2_developer_manual.html" title="DHIS2 Developer Manual"><link rel="up" href="ch01.html" title="Chapter&nbsp;1.&nbsp;Web API"><link rel="prev" href="ch01s37.html" title="1.37.&nbsp;Translations"><link rel="next" href="ch01s39.html" title="1.39.&nbsp;Users"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">1.38.&nbsp;Short Message Service (SMS)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch01s37.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;1.&nbsp;Web API</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch01s39.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e4723"></a>1.38.&nbsp;Short Message Service (SMS)</h2></div></div></div>
    
    <p>This section covers the SMS Web API for sending and receiving short text messages.</p>
    <div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e4726"></a>1.38.1.&nbsp;Outbound SMS service</h3></div></div></div>
      
      <p>The Web API supports sending outgoing SMS using the POST method. SMS can be sent to a
        single or multiple destinations. One or more gateways need to be configured before using the
        service. An SMS will not be sent if there is no gateway configured.&#8232; It needs a set of
        recipients and message text in JSON format as shown below. </p>
      <pre class="screen">/api/sms/outbound</pre>
      <pre class="screen">{&#8232;
  "message":"Sms Text",&#8232; 
  "recipients": [
    "47XXXXXX1",
    "47XXXXXX2"
  ]&#8232;
}</pre>
      <p>The Web API also supports a query parameter version, but the parameterized API can
        only be used for sending SMS to a single destination. </p>
      <pre class="screen">/api/sms/outbound?message=text&amp;recipient=47XXXXXX</pre>
    </div>
    <div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e4733"></a>1.38.2.&nbsp;Inbound SMS service</h3></div></div></div>
      
      <p>The Web API supports collecting incoming sms using the POST method. Incoming messages
        routed towards the DHIS 2 Web API can be received using this api. The API collects inbound
        SMSs and provides it to&#8232; listeners for parsing, based on the SMS content (SMS Command). An example payload
        in JSON format is given below. Text, originator, received date and sent date are mandatory
        parameters. The rest are optional but the system will use the default value for these
        parameters.</p>
      <pre class="screen">/api/sms/inbound</pre>
      <pre class="screen">{
  "text": "sample text",
  "originator": "47XXXXXXXX",
  "gatewayid": "unknown",
  "receiveddate": "2016-05-01",
  "sentdate":"2016-05-01",
  "smsencoding": "1",
  "smsstatus":"1"          
}</pre>
      <p>The Web API also supports a query parameter-based version.</p>
      <pre class="screen">/api/sms/inbound?message=text&amp;originator=47XXXXXX&amp;gateway=clickatel</pre>
      <div class="table"><a name="d5e4740"></a><p class="title"><b>Table&nbsp;1.63.&nbsp;User query parameters</b></p><div class="table-contents">
        
        <table summary="User query parameters" border="1"><colgroup><col class="c1"><col class="newCol2"><col class="c2"></colgroup><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>message</td><td>String</td><td>This is mandatory parameter which carries the actual text message.</td></tr><tr><td>originator</td><td>String</td><td>This is mandatory parameter which shows by whom this message was actually sent from.</td></tr><tr><td>gateway</td><td>String</td><td>This is an optional parameter which gives gateway id. If not present default text "UNKNOWN" will be stored</td></tr><tr><td>receiveTime</td><td>Date</td><td>This is an optional parameter. It is timestamp at which message was received at the gateway.</td></tr></tbody></table>
      </div></div><br class="table-break">
    </div>
    <div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e4768"></a>1.38.3.&nbsp;SMS service administration</h3></div></div></div>
      
      <p>The Web API supports SMS service APIs for service administration.</p>
      <p>Service can be started using the POST method.</p>
      <pre class="screen">POST /api/sms/service</pre>
      <p>Service can be stopped using the DELETE method.</p>
      <pre class="screen">DELETE /api/sms/service</pre>
      <p>Service status can be retrieved using the GET method.</p>
      <pre class="screen">GET /api/sms/service</pre>
      <p>SMS configurations can be reloaded using the PUT method.</p>
      <pre class="screen">PUT /api/sms/service</pre>
    </div>
    <div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e4779"></a>1.38.4.&nbsp;Gateway service administration</h3></div></div></div>
      
      <p>The Web API exposes resources which provide a way to configure and update SMS gateway
        configurations.</p>
      <p>The list of different gateways configured can be retrieved using a GET method.</p>
      <pre class="screen">GET /api/sms/gateways</pre>
      <p>Configurations can also be retrieved for a specific gateway type using GET
        method.</p>
      <pre class="screen">GET /api/sms/gateways/{uid}</pre>
      <p>Configurations can be removed for specific gateway type using DELETE method.</p>
      <pre class="screen">DELETE /api/sms/gateways/{uid}</pre>
      <p>Default gateway can be retrieved with the GET method.</p>
      <pre class="screen">GET /api/sms/gateways/default</pre>
      <p>Default gateway can be set using the PUT method.</p>
      <pre class="screen">PUT /api/sms/gateways/default/{uid}</pre>
    </div>
    <div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d5e4792"></a>1.38.5.&nbsp;Gateway configuration</h3></div></div></div>
      
      <p>The Web API lets you create and update gateway configurations. For each type of gateway
        there are different parameters in the JSON payload. Sample JSON payloads for each gateway
        are given below. POST is used to create and PUT to update configurations. </p>
      <p><span class="italic">Clickatell</span></p>
      <pre class="screen">{
  "name" : "clickatell",
  "username": "clickatelluser",
  "password": "abc123",
  "apiid": "12121"
}</pre>
      <p><span class="italic">Bulksms</span></p>
      <pre class="screen">{ 
  "name": "bulkSMS",
  "username": "bulkuser",
  "password": "abc123",
  "region": "Spain"
}</pre>
      <p><span class="italic">GenericHttp</span></p>
      <pre class="screen">{
  "name" : "generic",
  "username": "genericUser",
  "password": "abc123",
  "urlTemplate": "http://localhost:template",
  "parameters": {
  "parameter1": "value1",
  "parameter2": "value2"
  }
}</pre>
      <p><span class="italic">SMPP</span></p>
      <pre class="screen">{
  "name" : "smpp",
  "username": "smppUser",
  "password": "abc123",
  "address" : "sample.smpp.com",
  "port" : "8143"
}</pre>
      <p><span class="italic">Modem</span></p>
      <pre class="screen">{
  "name": "modem",
  "port": "COM1",
  "baudrate": "1000",
  "pollingInterval" : "10",
  "manufacturer" : "Nokia",
  "model" : "8124",
  "pin" : "1212"
}</pre>
      <p>The various gateway configurations can be instantiated using the endpoints listed
        below.</p>
      <div class="table"><a name="d5e4811"></a><p class="title"><b>Table&nbsp;1.64.&nbsp;Gateway api end points</b></p><div class="table-contents">
        
        <table summary="Gateway api end points" border="1"><colgroup><col class="c1"><col class="newCol2"><col class="c2"></colgroup><thead><tr><th>Gatway Type</th><th>Method</th><th>API End Points</th></tr></thead><tbody><tr><td>Clickatell</td><td>POST/PUT</td><td>/api/sms/gateways/clickatell</td></tr><tr><td>Bulksms</td><td>POST/PUT</td><td>/api/sms/gateways/bulksms</td></tr><tr><td>Generichttp</td><td>POST/PUT</td><td>/api/sms/gateways/generichttp</td></tr><tr><td>SMPP</td><td>POST/PUT</td><td>/api/sms/gateways/smpp</td></tr><tr><td>Modem</td><td>POST/PUT</td><td>/api/sms/gateways/modem</td></tr></tbody></table>
      </div></div><br class="table-break">
    </div>
  </div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch01s37.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch01.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch01s39.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">1.37.&nbsp;Translations&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="dhis2_developer_manual.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;1.39.&nbsp;Users</td></tr></table></div></body></html>