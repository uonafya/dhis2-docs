<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>1.20.&nbsp;Program rules</title><link rel="stylesheet" type="text/css" href="resources/css/docbook_bsd.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="dhis2_developer_manual.html" title="DHIS2 Developer guide"><link rel="up" href="webapi.html" title="Chapter&nbsp;1.&nbsp;Web API"><link rel="prev" href="webapi_events.html" title="1.19.&nbsp;Events"><link rel="next" href="webapi_forms.html" title="1.21.&nbsp;Forms"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">1.20.&nbsp;Program rules</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="webapi_events.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;1.&nbsp;Web API</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="webapi_forms.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="webapi_program_rules"></a>1.20.&nbsp;Program rules</h2></div></div></div><p>This section is about sending and reading program rules, and explains the program rules
      data model. The program rules gives functionality to configure dynamic behavior in the
      programs in DHIS.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="webapi_program_rule_model"></a>1.20.1.&nbsp;Program rule model</h3></div></div></div><p>The program rules data model consists of programRuleVariables, programRules and
        programRuleActions. The programRule contains an expression - when this expression is true,
        the child programRuleActions is triggered. The programRuleVariables is used to address data
        elements, tracked entity data values and other data values needed to run the expressions.
        All programRules in a program share the same library of programRuleVariables, and one
        programRuleVariable can be used in several programRules' expressions. </p><div class="screenshot"><p class="title"><b>DHIS2 Login screen</b></p><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="80%"><tr><td><img src="resources/images/program_rules/program-rule-model.jpg" width="100%"></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e4959"></a>1.20.1.1.&nbsp;Program rule model details</h4></div></div></div><p>The following table gives a detailed overview over the programRule model.</p><div class="table"><a name="d0e4964"></a><p class="title"><b>Table&nbsp;1.35.&nbsp; programRule </b></p><div class="table-contents"><table class="table" summary=" programRule " border="1"><colgroup><col class="c1"><col class="c2"><col class="c3"></colgroup><thead><tr><th>name</th><th>description</th><th>Compulsory</th></tr></thead><tbody><tr><td>program</td><td>The program of which the programRule is executed in.</td><td>Compulsory</td></tr><tr><td>name</td><td>The name with which the program rule will be displayed to dhis configurators.
                  Not visisble to the end user of the program.</td><td>Compulsory</td></tr><tr><td>description</td><td>The description of the program rule, can be used by configurators to describe
                  the rule. Not visisble to the end user of the program.</td><td>Compulsory</td></tr><tr><td>programStage</td><td>If a programStage is set for a program rule, the rule will only be evaluated
                  inside the specified program stage.</td><td>optional</td></tr><tr><td>condition</td><td>The expression that needs to be evaluated to true in order for the program
                  rule to trigger its child actions. The expression is written using operators,
                  function calls, hard coded values, constants and program rule variables.
                  <pre class="screen">d2:hasValue('hemoglobin') &amp;&amp; #{hemoglobin} &lt;= 7</pre></td><td>Compulsory</td></tr><tr><td>priority</td><td>The priority to run the rule in cases where the order of the rules matters.
                  In most cases the rules does not depend on being run before or after other rules,
                  and in these cases the priority can be omitted. If no priority is set, the rule
                  will be run after any rules that has a priority defined. If a priority(integer) is
                  set, the rule with the lowest priority will be run before rules with higher
                  priority.</td><td>optional</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e5024"></a>1.20.1.2.&nbsp;Program rule action model details</h4></div></div></div><p>The following table gives a detailed overview over the programRuleAction model.</p><div class="table"><a name="d0e5029"></a><p class="title"><b>Table&nbsp;1.36.&nbsp; programRuleAction </b></p><div class="table-contents"><table class="table" summary=" programRuleAction " border="1"><colgroup><col class="c1"><col class="c2"><col class="c3"></colgroup><thead><tr><th>name</th><th>description</th><th>Compulsory</th></tr></thead><tbody><tr><td>programRule</td><td>The programRule that is the parent of this action.</td><td>Compulsory</td></tr><tr><td>programRule- ActionType</td><td>The type of action that is to be performed. <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold"><strong>DISPLAYTEXT</strong></span> - Displays a text in a
                        given widget.</p></li><li class="listitem"><p><span class="bold"><strong>DISPLAYKEYVALUEPAIR</strong></span> - Displays a key
                        and value pair(like a program indicator) in a given widget.</p></li><li class="listitem"><p><span class="bold"><strong>HIDEFIELD</strong></span> - Hide a specified
                        dataElement or trackedEntityAttribute.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><span class="italic">content</span> - if defined, the text in
                              <span class="italic">content</span> will be displayed to the
                            end user in the instance where a value is previously entered into a
                            field that is now about to be hidden (and therefore blanked). If
                              <span class="italic">content</span> is not defined, a standard
                            message will be shown to the user in this instance. </p></li><li class="listitem"><p><span class="italic">dataElement</span> - if defined*, the
                            HIDEFIELD action will hide this dataElement when the rule is
                            effective.</p></li><li class="listitem"><p><span class="italic">trackedEntityDataValue</span> - if
                            defined*, the HIDEFIELD action will hide this trackedEntityDataValue
                            when the rule is effective. </p></li></ul></div></li><li class="listitem"><p><span class="bold"><strong>HIDESECTION</strong></span> - Hide a specified
                        section.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><span class="italic">programStageSection</span> - must be
                            defined. This is the programStageSection that will be hidden in case the
                            parent rule is effective.</p></li></ul></div></li><li class="listitem"><p><span class="bold"><strong>ASSIGN</strong></span> - Assign a dataElement a
                        value(help the user calculate something or fill in an obvious value
                        somewhere)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><span class="italic">content</span> - if defined*, the value
                            in <span class="italic">data</span> is assigned to this variable.
                            If content id defined, and thus a variable is assigned for use in other
                            rules, it is important to also assign a <span class="italic">
                              programRule.priority</span> to make sure the rule with an ASSIGN
                            action runs before the rule that will in turn evaluate the assigned
                            variable.</p></li><li class="listitem"><p><span class="italic">data</span> - must be defined, data
                            forms an expression that is evaluated and assigned to either a
                            variable(#{myVariable}), a dataElement, or both.</p></li><li class="listitem"><p><span class="italic">dataElement</span> - if defined*, the
                            value in <span class="italic">data</span> is assigned to this
                            data element.</p></li></ul></div><p>* Either the content or dataElement must be defined for the ASSIGN
                        action to be effective.</p></li><li class="listitem"><p><span class="bold"><strong>SHOWWARNING</strong></span> - Show a warning to the
                        user, not blocking the user from completing the event or
                        registration.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><span class="italic">content</span> - if defined, content is
                            a static part that is displayed at the end of the error message.</p></li><li class="listitem"><p><span class="italic">data</span> - if defined, data forms an
                            expression that is evaluated and added to the end of the warning
                            message.</p></li><li class="listitem"><p><span class="italic">dataElement</span> - if defined*, the
                            warning message is displayed next to this data element.</p></li><li class="listitem"><p><span class="italic">trackedEntityAttribute</span> - if
                            defined*, the warning message is displayed next to this tracked entity
                            attribute.</p></li></ul></div><p>*Either dataElement or trackedEntityAttribute must be specified.</p></li><li class="listitem"><p><span class="bold"><strong>SHOWERROR</strong></span> - Show an error to the user,
                        blocking the user from completing the event or registration.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><span class="italic">content</span> - if defined, content is
                            a static part that is displayed in the start of the error
                            message.</p></li><li class="listitem"><p><span class="italic">data</span> - if defined, data forms an
                            expression that is evaluated and added to the end of the error
                            message.</p></li><li class="listitem"><p><span class="italic">dataElement</span> - if defined*, the
                            error message is linked to this data element.</p></li><li class="listitem"><p><span class="italic">trackedEntityAttribute</span> - if
                            defined*, the error message is linked to this tracked entity
                            attribute.</p></li></ul></div><p>*Either dataElement or trackedEntityAttribute must be specified.</p></li><li class="listitem"><p><span class="bold"><strong>WARNINGONCOMPLETINON</strong></span> - Show a warning
                        to the user on the "Complete form" dialog, but allowing the user to complete
                        the event.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><span class="italic">content</span> - if defined, content is
                            a static part that is displayed at the end of the error message.</p></li><li class="listitem"><p><span class="italic">data</span> - if defined, data forms an
                            expression that is evaluated and added to the end of the warning
                            message.</p></li><li class="listitem"><p><span class="italic">dataElement</span> - if defined, the
                            warning message prefixed with the name/formName of the data
                            element.</p></li></ul></div></li><li class="listitem"><p><span class="bold"><strong>ERRORONCOMPLETION</strong></span> - Show an error to
                        the user on in a modal window when the user tries to complete the event. The
                        user is prevented from completing the event.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><span class="italic">content</span> - if defined, content is
                            a static part that is displayed in the start of the error
                            message.</p></li><li class="listitem"><p><span class="italic">data</span> - if defined, data forms an
                            expression that is evaluated and added to the end of the error
                            message.</p></li><li class="listitem"><p><span class="italic">dataElement</span> - if defined, the
                            error message is linked to this data element.</p></li></ul></div></li><li class="listitem"><p><span class="bold"><strong>CREATEEVENT</strong></span> - Create an event within
                        the same enrollment.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><span class="italic">content</span></p></li><li class="listitem"><p><span class="italic">data</span> - if defined, contains data
                            values to assign the created event. The format is &lt;uid&gt;:&lt;data
                            value&gt;. Where several values is specified, these are separated with
                            comma.
                            </p><pre class="screen">AcMrnleqHqc:100,AqK1IHqCkEE:'Polyhydramnios'</pre></li><li class="listitem"><p><span class="italic">programStage</span> - must be defined,
                            and designates the program stage that the rule shall create an event
                            of.</p></li></ul></div></li><li class="listitem"><p><span class="bold"><strong>SETMANDATORYFIELD</strong></span> - Set a field to be
                        mandatory.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><span class="italic">dataElement</span> - if defined, this
                            data element will be set to be mandatory in the data entry form.</p></li><li class="listitem"><p><span class="italic">trackedEntityAttribute</span> - if
                            defined, this tracked entity attribute will be set to mandatory in the
                            registration form or profile.</p></li></ul></div></li></ul></div></td><td>Compulsory</td></tr><tr><td>location</td><td>Used for actionType DISPLAYKEYVALUEPAIR and DISPLAYTEXT to designate which
                  widget to display the text or keyvalyepair in. Compulsory for DISPLAYKEYVALUEPAIR
                  and DISPLAYTEXT.</td><td>See description</td></tr><tr><td>content</td><td>Used for user messages in the different actions. See the actionType overview
                  for a detailed explanation for how it is used in each of the action types.
                  Compulsory for SHOWWARNING, SHOWERROR, WARNINGONCOMPLETION, ERRORONCOMPLETION,
                  DISPLAYTEXT and DISPLAYKEYVALUEPAIR. Optional for HIDEFIELD and ASSIGN.</td><td>See description</td></tr><tr><td>data</td><td>Used for expressions in the different actions. See the actionType overview
                  for a detailed explanation for how it is used in each of the action types.
                  Compulsory for ASSIGN. Optional for SHOWWARNING, SHOWERROR, WARNINGONCOMPLETION,
                  ERRORONCOMPLETION, DISPLAYTEXT, CREATEEVENT and DISPLAYKEYVALUEPAIR</td><td>See description</td></tr><tr><td>dataElement</td><td>Used for linking rule actions to dataElements. See the actionType overview
                  for a detailed explanation for how it is used in each of the action types.
                  Optional for SHOWWARNING, SHOWERROR, WARNINGONCOMPLETION, ERRORONCOMPLETION,
                  ASSIGN and HIDEFIELD</td><td>See description</td></tr><tr><td>trackedEntity- Attribute</td><td>Used for linking rule actions to trackedEntityAttributes. See the actionType
                  overview for a detailed explanation for how it is used in each of the action
                  types. Optional for SHOWWARNING, SHOWERROR and HIDEFIELD.</td><td>See description</td></tr><tr><td>programStage</td><td>Only used for CREATEEVENT rule actions. Compulsory for CREATEEEVENT.</td><td>See description</td></tr><tr><td>programStage- Section</td><td>Only used for HIDESECTION rule actions. Compulsory for HIDESECTION</td><td>See description</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="d0e5325"></a>1.20.1.3.&nbsp;Program rule variable model details</h4></div></div></div><p>The following table gives a detailed overview over the programRuleVariable
          model.</p><div class="table"><a name="d0e5330"></a><p class="title"><b>Table&nbsp;1.37.&nbsp; programRuleVariable </b></p><div class="table-contents"><table class="table" summary=" programRuleVariable " border="1"><colgroup><col class="c1"><col class="c2"><col class="c3"></colgroup><thead><tr><th>name</th><th>description</th><th>Compulsory</th></tr></thead><tbody><tr><td>name</td><td>the name for the programRuleVariable - this name is used in expressions.
                  <pre class="screen">#{myVariable} &gt; 5</pre></td><td>Compulsory</td></tr><tr><td>sourceType</td><td>Defines how this variable is populated with data from the enrollment and
                  events. <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>DATAELEMENT_NEWEST_EVENT_PROGRAM_STAGE - In tracker capture, gets the
                        newest value that exists for a dataelement, within the events of a given
                        program stage in the current enrollment. In event capture, gets the newest
                        value among the 10 newest events on the organisation unit.</p></li><li class="listitem"><p>DATAELEMENT_NEWEST_EVENT_PROGRAM - In tracker capture, get the newest
                        value that exists for a dataelement across the whole enrollment. In event
                        capture, gets the newest value among the 10 newest events on the
                        organisation unit. </p></li><li class="listitem"><p>DATAELEMENT_CURRENT_EVENT - Gets the value of the given dataelement in
                        the current event only.</p></li><li class="listitem"><p>DATAELEMENT_PREVIOUS_EVENT - In tracker capture, gets the newest value
                        that exists among events in the program that precedes the current event. In
                        event capture, gets the newvest value among the 10 preceeding events
                        registered on the organisation unit.</p></li><li class="listitem"><p>CALCULATED_VALUE - Used to reserve a variable name that will be assigned
                        by a ASSIGN program rule action</p></li><li class="listitem"><p>TEI_ATTRIBUTE - Gets the value of a given tracked entity
                        attribute</p></li></ul></div></td><td>Compulsory</td></tr><tr><td>dataElement</td><td>Used for linking the programRuleVariable to a dataElement. Compulsory for all
                  sourceTypes that starts with DATAELEMENT_.</td><td>See description</td></tr><tr><td>trackedEntity- Attribute</td><td>Used for linking the programRuleVariable to a trackedEntityAttribute.
                  Compulsory for sourceType TEI_ATTRIBUTE.</td><td>See description</td></tr><tr><td>useCodeFor- OptionSet</td><td>If checked, the variable will be populated with the code - not the name -
                  from any linked option set. Default is unchecked, meaning that the name of the
                  option is populated.</td><td>&nbsp;</td></tr><tr><td>programStage</td><td>Used for specifying a specific program stage to retreive the
                  programRuleVariable value from. Compulsory for
                  DATAELEMENT_NEWEST_EVENT_PROGRAM_STAGE.</td><td>See description</td></tr></tbody></table></div></div><br class="table-break"></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="webapi_creating_program_rules"></a>1.20.2.&nbsp;Creating program rules</h3></div></div></div><p>-coming-</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="webapi_events.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="webapi.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="webapi_forms.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">1.19.&nbsp;Events&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="dhis2_developer_manual.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;1.21.&nbsp;Forms</td></tr></table></div></body></html>