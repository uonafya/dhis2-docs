<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>1.10.&nbsp;Metadata create, read, update, delete, validate</title><link rel="stylesheet" type="text/css" href="resources/css/docbook_bsd.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="dhis2_developer_manual.html" title="DHIS2 Developer Manual"><link rel="up" href="ch01.html" title="Chapter&nbsp;1.&nbsp;Web API"><link rel="prev" href="ch01s09.html" title="1.9.&nbsp;Metadata field filter"><link rel="next" href="ch01s11.html" title="1.11.&nbsp;CSV metadata import"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">1.10.&nbsp;Metadata create, read, update, delete, validate</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch01s09.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;1.&nbsp;Web API</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch01s11.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1523"></a>1.10.&nbsp;Metadata create, read, update, delete, validate</h2></div></div></div><p>While some of the web-api endpoints already contains support for CRUD (create, read,
      update, delete), from version 2.15 this is now supported on all endpoints. It should work as
      you expect, and the subsections will give more detailed information about create, update, and
      delete (read is already covered elsewhere, and have been supported for a long time).</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1528"></a>1.10.1.&nbsp;Create / update parameters</h3></div></div></div><p>The following query parameters are available for customizing your request.</p><p>
        </p><div class="table"><a name="d0e1535"></a><p class="title"><b>Table&nbsp;1.13.&nbsp;Available Query Filters</b></p><div class="table-contents"><table class="table" summary="Available Query Filters" border="1"><colgroup><col><col><col><col><col></colgroup><thead><tr><th> Param </th><th> Type </th><th> Required </th><th> Options (default first) </th><th> Description </th></tr></thead><tbody><tr><td>preheatCache</td><td>boolean</td><td>false</td><td>true | false</td><td>Turn cache-map preheating on/off. This is on by default, turning this off
                  will make initial load time for importer much shorter (but will make the import
                  itself slower). This is mostly used for cases where you have a small XML/JSON file
                  you want to import, and don't want to wait for cache-map preheating.</td></tr><tr><td>strategy</td><td>enum</td><td>false</td><td>CREATE_AND_UPDATE | CREATE | UPDATE | DELETE</td><td>Import strategy to use, see below for more information.</td></tr><tr><td>mergeMode</td><td>enum</td><td>false</td><td>REPLACE, MERGE</td><td>Strategy for merging of objects when doing updates. REPLACE will just
                  overwrite the propery with the new value provided, MERGE will only set the
                  property if its not null (only if the property was provided).</td></tr></tbody></table></div></div><p><br class="table-break">
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1586"></a>1.10.2.&nbsp;Creating and updating objects</h3></div></div></div><p>For creating new objects you will need to know the endpoint, the type format, and make
        sure that you have the required authorities. As an example , we will create and update an
          <span class="italic">constant</span>. To figure out the format, we can use the new
          <span class="italic">schema</span> endpoint for getting format description. So we
        will start with getting that
        info:</p><pre class="screen">http://&lt;&lt;server&gt;&gt;/api/schemas/constant.json</pre><p> From the
        output, you can see that the required authorities for create are F_CONSTANT_ADD, and the
        important properties are: <span class="italic">name</span> and <span class="italic">value</span>. From this we can create a JSON payload and save it as a
        file called
        constant.json:</p><pre class="screen">{
  "name": "PI",
  "value": "3.14159265359"
}</pre><p>The same content as an XML
        payload:</p><pre class="screen">&lt;constant name="PI" xmlns="http://dhis2.org/schema/dxf/2.0"&gt;
  &lt;value&gt;3.14159265359&lt;/value&gt;
&lt;/constant&gt;</pre><p>We are now ready create the new <span class="italic">constant</span> by sending a
        POST request to the <span class="italic">constants </span>endpoint with the JSON
        payload using curl:
        </p><pre class="screen">curl -d @constant.json "http://server/api/24/constants" -X POST 
-H "Content-Type: application/json" -u user:password</pre><p>A specific example of posting the constant to the demo server:
        </p><pre class="screen">curl -d @constant.json "https://play.dhis2.org/api/24/constants" -X POST 
-H "Content-Type: application/json" -u admin:district</pre><p>If everything went well, you should see an output similar
        to:</p><pre class="screen">{
  "status":"SUCCESS",
  "importCount":{"imported":1,"updated":0,"ignored":0,"deleted":0},
  "type":"Constant"
}</pre><p>The process will be exactly the same for updating, you make your changes to the JSON/XML
        payload, find out the <span class="italic">ID</span> of the constant, and then send a
        PUT request to the endpoint including
        ID:</p><pre class="screen">curl -X PUT -d @pi.json -H "Content-Type: application/json" 
-u user:password http://server/api/24/constants/ID</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1637"></a>1.10.3.&nbsp;Deleting objects</h3></div></div></div><p>Deleting objects are very straight forward, you will need to know the <span class="italic">ID</span> and the endpoint of the type you want delete, let's
        continue our example from the last section and use a <span class="italic">constant</span>. Let's assume that the id is <span class="italic">abc123</span>, then all you need to do is the send the DELETE request to the endpoint
        +
        id:</p><pre class="screen">curl -X DELETE -u user:password
http://server/api/24/constants/ID</pre><p>A successful delete should return HTTP status 204 (no content).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1655"></a>1.10.4.&nbsp;Adding and removing objects to/from collections</h3></div></div></div><p>In order to add or remove objects to or from a collection of objects you can use the
        following
        pattern:</p><pre class="screen">/api/24/{collection-object}/{collection-object-id}/{collection-name}/{object-id}</pre><p>You should use the POST method to add, and the DELETE method to remove an object. The
        components of the pattern are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>collection object: The type of objects that owns the collection you want to
            modify.</p></li><li class="listitem"><p>collection object id: The identifier of the object that owns the collection you want
            to modify.</p></li><li class="listitem"><p>collection name: The name of the collection you want to modify.</p></li><li class="listitem"><p>object id: The identifier of the object you want to add or remove from the
            collection.</p></li></ul></div><p>As an example, in order to remove a data element with identifier IDB from a data element
        group with identifier IDA you can do a DELETE
        request:</p><pre class="screen">DELETE /api/24/dataElementGroups/IDA/dataElements/IDB</pre><p>To add a category option with identifier IDB to a category with identifier IDA you can
        do a POST request:</p><pre class="screen">POST /api/24/categories/IDA/categoryOptions/IDB</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1685"></a>1.10.5.&nbsp;Validating payloads</h3></div></div></div><p>System wide validation of metadata payloads are enabled from 2.19 release, this means
        that create/update operations on the web-api endpoints will be checked for valid payload
        before allowed changes to be made, to find out what validations are in place for a endpoint,
        please have a look at the /api/schemas endpoint, i.e. to figure out which constraints a data
        element have, you would go to /api/schemas/dataElement.</p><p>You can also validate your payload manually by sending it to the proper schema endpoint.
        If you wanted to validate the constant from the create section before, you would send it
        like this:</p><pre class="screen">POST /api/schemas/constant
{ payload }</pre><p>A simple (non-validating) example would
        be:</p><pre class="screen">curl -X POST -d "{\"name\": \"some name\"}" -H "Content-Type: application/json" 
-u admin:district https://play.dhis2.org/dev/api/schemas/dataElement</pre><p>Which would yield the
        result:</p><pre class="screen">[
   {
      "message" : "Required property missing.",
      "property" : "type"
   },
   {
      "property" : "aggregationOperator",
      "message" : "Required property missing."
   },
   {
      "property" : "domainType",
      "message" : "Required property missing."
   },
   {
      "property" : "shortName",
      "message" : "Required property missing."
   }
]</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1702"></a>1.10.6.&nbsp;Partial updates</h3></div></div></div><p>For cases where you don't want or need to update all properties on a object (which
        means downloading a potentially huge payload, change one property, then upload again) we now
        support partial update, both for single properties and for multiple properties.</p><p>The format for updating a single property is the same as when you are updating a
        complete object, just with only 1 property in the JSON/XML file,
        i.e.:</p><pre class="screen">curl -X PATCH -d "{\"name\": \"New Name\"}" -H "Content-Type: application/json" 
-u admin:district https://play.dhis2.org/dev/api/24/dataElements/fbfJHSPpUQD/name</pre><p>Please note that we are including the property name two times, one time in the payload,
        and one time in the endpoint, the generic endpoint for this is <span class="italic">/api/type/id/property-name</span>, and the <span class="italic">Content-Type</span> must also be included as usual (since we support multiple
        formats).</p><p>The format for updating multiple properties are similar, just that we don't include
        the property names in the url,
        i.e.:</p><pre class="screen">{ // file.json
  "name": "Updated Name",
  "zeroIsSignificant": true
}</pre><pre class="screen">curl -X PATCH -d @file.json -H "Content-Type: application/json" 
-u admin:district https://play.dhis2.org/dev/api/24/dataElements/fbfJHSPpUQD</pre></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch01s09.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch01.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch01s11.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">1.9.&nbsp;Metadata field filter&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="dhis2_developer_manual.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;1.11.&nbsp;CSV metadata import</td></tr></table></div></body></html>