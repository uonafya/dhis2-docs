<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>1.43.&nbsp;Users</title><link rel="stylesheet" type="text/css" href="resources/css/docbook_bsd.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="dhis2_developer_manual.html" title="DHIS2 Developer Manual"><link rel="up" href="ch01.html" title="Chapter&nbsp;1.&nbsp;Web API"><link rel="prev" href="ch01s42.html" title="1.42.&nbsp;Short Message Service (SMS)"><link rel="next" href="ch01s44.html" title="1.44.&nbsp;Current user information and associations"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">1.43.&nbsp;Users</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch01s42.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;1.&nbsp;Web API</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch01s44.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e9954"></a>1.43.&nbsp;Users</h2></div></div></div><p>This section covers the user resource methods.</p><pre class="screen">/api/users</pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e9961"></a>1.43.1.&nbsp;User query</h3></div></div></div><p>The <span class="italic">users</span> resource offers additional query parameters
        beyond the standard parameters (e.g. paging). To query for users at the users resource you
        can use the following parameters.</p><p>
        </p><div class="table"><a name="d0e9971"></a><p class="title"><b>Table&nbsp;1.76.&nbsp;User query parameters</b></p><div class="table-contents"><table class="table" summary="User query parameters" border="1"><colgroup><col class="c1"><col class="newCol2"><col class="c2"></colgroup><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>query</td><td>Text</td><td>Query value for first name, surname, username and email, case
                  in-sensitive.</td></tr><tr><td>phoneNumber</td><td>Text</td><td>Query for phone number.</td></tr><tr><td>canManage</td><td>false | true</td><td>Filter on whether the current user can manage the returned users through the
                  managed user group relationships.</td></tr><tr><td>authSubset</td><td>false | true</td><td>Filter on whether the returned users have a subset of the authorities of the
                  current user.</td></tr><tr><td>lastLogin</td><td>Date</td><td>Filter on users who have logged in later than the given date.</td></tr><tr><td>inactiveMonths</td><td>Number</td><td>Filter on users who have not logged in for the given number of
                  months.</td></tr><tr><td>inactiveSince</td><td>Date</td><td>Filter on users who have not logged in later than the given date.</td></tr><tr><td>selfRegistered</td><td>false | true</td><td>Filter on users who have self-registered their user account.</td></tr><tr><td>invitationStatus</td><td>none | all | expired</td><td>Filter on user invitations, including all or expired invitations.</td></tr><tr><td>ou</td><td>Identifier</td><td>Filter on users who are associated with the organisation unit with the given
                  identifier.</td></tr><tr><td>page</td><td>Number</td><td>The page number.</td></tr><tr><td>pageSize</td><td>Number</td><td>The page size.</td></tr></tbody></table></div></div><p><br class="table-break">
      </p><p>A query for max 10 users with "konan" as first name or surname (case
        in-sensitive) who have a subset of authorities compared to the current user:</p><pre class="screen">/api/users?query=konan&amp;authSubset=true&amp;pageSize=10</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e10076"></a>1.43.2.&nbsp;UserCredentials query</h3></div></div></div><p>An alternative to the previous user query, is to directly query the user credentials
        (the part where username, etc resides) using <span class="italic">/api/userCredentials</span> endpoint, it supports all regular field and object
        filters as the other endpoints.</p><p>Get user credentials where username is
        admin:</p><pre class="screen">/api/userCredentials?filter=username:eq:admin</pre><p>Get username  and code from all user credentials where username starts with <span class="italic">adm</span>:</p><pre class="screen">/api/userCredentials?fields=username,code&amp;filter=username:^like:adm</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e10095"></a>1.43.3.&nbsp;User account create and update</h3></div></div></div><p>Both creating and updating a user is supported through the web-api. The payload itself
        is similar to other payloads in the web-api, so they support collection references etc. A
        simple example payload to create would be, the password should be sent in plain text
        (remember to only use this on a SSL enabled server) and will be encrypted on the
        backend:</p><pre class="screen">{
  "firstName": "John",
  "surname": "Doe",
  "email": "johndoe@mail.com",
  "userCredentials": {
    "username": "johndoe",
    "password: "your-password-123",
    "userRoles": [ {
      "id": "Euq3XfEIEbx"
    } ]
  },
  "organisationUnits": [ {
    "id": "ImspTQPwCqd"
  } ],
  "userGroups": [ {
    "id": "vAvEltyXGbD"
  } ]
}</pre><pre class="screen">curl -X POST -u user:pass -d @u.json -H "Content-Type: application/json" http://server/api/users</pre><p>After the user is created, a <span class="italic">Location</span> header is sent
        back with the newly generated ID (you can also provide your own using /api/system/id
        endpoint). The same payload can then be used to do updates, but remember to then use
          <span class="bold"><strong>PUT</strong></span> instead of <span class="bold"><strong>POST</strong></span> and
        the endpoint is now <span class="italic">/api/users/ID</span>.</p><pre class="screen">curl -X PUT -u user:pass -d @u.json -H "Content-Type: application/json" http://server/api/users/ID</pre><p>For more info about the full payload available, please see <span class="italic">/api/schemas/user</span></p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e10124"></a>1.43.4.&nbsp;User account invitations</h3></div></div></div><p>The Web API supports inviting people to create user accounts through the <span class="italic">invite</span> resource. To create an invitation you should POST a user
        in XML or JSON format to the invite resource. A specific username can be forced by defining
        the username in the posted entity. By omitting the username, the person will be able to
        specify it herself. The system will send out an invitation through email. This requires that
        email settings have been properly configured. The invite resource is useful in order to
        securely allow people to create accounts without anyone else knowing the password or by
        transferring the password in plain text. The payload to use for the invite is the same as
        for creating users. An example payload in JSON looks like this:</p><pre class="screen">{
  "firstName": "John",
  "surname": "Doe",
  "email": "johndoe@mail.com",
  "userCredentials": {
    "username": "johndoe",
    "userRoles": [ {
      "id": "Euq3XfEIEbx"
    } ]
  },
  "organisationUnits": [ {
    "id": "ImspTQPwCqd"
  } ],
  "userGroups": [ {
    "id": "vAvEltyXGbD"
  } ]
}</pre><p>The user invite entity can be posted like this:</p><pre class="screen">curl -d @invite.json "localhost/api/users/invite" -H "Content-Type:application/json" -u admin:district -v</pre><p>To send out invites for multiple users at the same time you must use a slightly
        different format. For
        JSON:</p><pre class="screen">{
  "users": [ {
    "firstName": "John",
    "surname": "Doe",
    "email": "johndoe@mail.com",
    "userCredentials": {
      "username": "johndoe",
      "userRoles": [ {
        "id": "Euq3XfEIEbx"
      } ]
    },
    "organisationUnits": [ {
      "id": "ImspTQPwCqd"
      } ]
    }, {
    "firstName": "Tom",
    "surname": "Johnson",
    "email": "tomj@mail.com",
    "userCredentials": {
      "userRoles": [ {
        "id": "Euq3XfEIEbx"
      } ]
    },
    "organisationUnits": [ {
      "id": "ImspTQPwCqd"
      } ]
    }
  ]
}</pre><p>To create multiple invites you can post the payload to the api/users/invites resource
        like this:</p><pre class="screen">curl -d @invites.json "localhost/api/users/invites" -H "Content-Type:application/json" -u admin:district -v</pre><p>There are certain requirements for user account invitations to be sent out:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Email SMTP server must be configured properly on the server.</p></li><li class="listitem"><p>The user to be invited must have specified a valid email.</p></li><li class="listitem"><p>The user to be invited must not be granted user roles with critical authorities
              (see below).</p></li><li class="listitem"><p>If username is specified it must not be already taken by another existing
              user.</p></li></ul></div><p>If any of these requirements are not met the invite resource will return with
        a <span class="italic">409 Conflict</span> status code together with a descriptive
        message. </p><p>The critical authorities which cannot be granted with invites include:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ALL</p></li><li class="listitem"><p>Scheduling administration</p></li><li class="listitem"><p>Set system settings</p></li><li class="listitem"><p>Add, update, delete and list user roles</p></li><li class="listitem"><p>Add, update, delete and view SQL views</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e10183"></a>1.43.5.&nbsp;User replication</h3></div></div></div><p>To replicate a user you can use the <span class="italic">replica</span> resource.
        Replicating a user can be useful when debugging or reproducing issues reported by a
        particular user. You need to provide a new username and password for the replicated user
        which you will use to authenticate later. Note that you need the ALL authority to perform
        this action. To replicate a user you can post a JSON payload looking like below:</p><pre class="screen">{
  "username": "replica",
  "password": "Replica.1234"
}</pre><p>This payload can be posted to the replica resource, where you provide the identifier of
        the user to replicate in the URL:</p><pre class="screen">/api/users/&lt;uid&gt;/replica</pre><p>An example of replicating a user using curl looks like this:</p><pre class="screen">curl -d @replica.json "localhost/api/users/N3PZBUlN8vq/replica" 
-H "Content-Type:application/json" -u admin:district -v</pre></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch01s42.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch01.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch01s44.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">1.42.&nbsp;Short Message Service (SMS)&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="dhis2_developer_manual.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;1.44.&nbsp;Current user information and associations</td></tr></table></div></body></html>