<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>A.6.&nbsp;Using R, DHIS2 and the Google Visualization API</title><link rel="stylesheet" type="text/css" href="resources/css/docbook_bsd.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="dhis2_developer_manual.html" title="DHIS2 Developer Manual"><link rel="up" href="apa.html" title="Appendix&nbsp;A.&nbsp;DHIS2 and R integration"><link rel="prev" href="apas05.html" title="A.5.&nbsp;Mapping with R and PostgreSQL"><link rel="next" href="apas07.html" title="A.7.&nbsp;Using PL/R with DHIS2"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">A.6.&nbsp;Using R, DHIS2 and the Google Visualization API</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="apas05.html">Prev</a>&nbsp;</td><th width="60%" align="center">Appendix&nbsp;A.&nbsp;DHIS2 and R integration</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="apas07.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dhis2_r_google_vis"></a>A.6.&nbsp;Using R, DHIS2 and the Google Visualization API</h2></div></div></div><p>Google's Visualization API provides a very rich set of tools for the visualization of multi-dimensional data. In this simple example, we will show how to create a simple motion chart with the Google Visualization API using the "googleVis" R package. Full information on the package can be found <a class="link" href="http://code.google.com/p/google-motion-charts-with-r/" target="_top">here.</a>. The basic principle, as with the other examples, is to get some data from the DHIS2 database, and bring it into R, perform some minor alterations on the data to make it easier to work with, and then create the chart. In this case, we will compare ANC1,2,3 data over time and see how they are related with a motion chart.</p><pre class="screen">#Load some libraries
library(RPostgreSQL)
library(googleVis)
library(reshape)
#A small helper function to get a data frame from some SQL
dfFromSQL&lt;-function (con,sql){
    rs&lt;-dbSendQuery(con,sql)
    result&lt;-fetch(rs,n=-1)
    return(result)
}

#Get a database connection
user&lt;-"postgres"
password&lt;-"postgres"
host&lt;-"127.0.0.1"
port&lt;-"5432"
dbname&lt;-"dhis2_demo"
con &lt;- dbConnect(PostgreSQL(), user= user,
password=password,host=host, port=port,dbname=dbname)
#Let's retrieve some ANC data from the demo database
sql&lt;-"SELECT ou.shortname as province,
i.shortname as indicator,
extract(year from p.startdate) as year,
 a.value
FROM aggregatedindicatorvalue a
INNER JOIN  organisationunit ou on a.organisationunitid = ou.organisationunitid
INNER JOIN indicator i on a.indicatorid = i.indicatorid
INNER JOIN period p on a.periodid = p.periodid
WHERE a.indicatorid IN
(SELECT DISTINCT indicatorid from indicator where shortname ~*('ANC [123] Coverage'))
AND a.organisationunitid IN
 (SELECT DISTINCT idlevel2 from _orgunitstructure where idlevel2 is not null)
AND a.periodtypeid = (SELECT DISTINCT periodtypeid from periodtype where name = 'Yearly')"
#Store this in a data frame
anc&lt;-dfFromSQL(con,sql)
#Change these some columns to factors so that the reshape will work more easily

anc$province&lt;-as.factor(anc$province)
anc$indicator&lt;-as.factor(anc$indicator)
#We need the time variable as numeric
anc$year&lt;-as.numeric(as.character(anc$year))
#Need to cast the table into a slightly different format
anc&lt;-cast(anc,province + year ~ indicator)
#Now, create the motion chart and plot it
M&lt;-gvisMotionChart(anc,idvar="province",timevar="year")
plot(M)</pre><p>The resulting graph is displayed below.</p><div class="screenshot"><div class="mediaobject"><img src="resources/images/r/google_vis_col_chart.PNG"></div></div><p>Using packages like <a class="link" href="http://cran.r-project.org/package=brew" target="_top">brew</a> or <a class="link" href="http://rapache.net" target="_top">Rapache</a>, these types of graphs could be easily integrated into external web sites. A fully functional version of the chart shown above can be accessed <a class="link" href="http://dhis2.net/R/google-motion-chart.html" target="_top">here.</a></p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="apas05.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="apa.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="apas07.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">A.5.&nbsp;Mapping with R and PostgreSQL&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="dhis2_developer_manual.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;A.7.&nbsp;Using PL/R with DHIS2</td></tr></table></div></body></html>